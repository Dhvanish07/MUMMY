<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUMMY ‚Äì Login</title>
    <style>
        :root {
            --primary-orange: #FF6B35;
            --primary-warm: #FFD166;
            --primary-green: #06A77D;
            --text-dark: #2D3436;
            --bg-light: #FEFDFB;
            --bg-warm: #FFF5E1;
            --border-color: #FFE5CC;
            --shadow-medium: 0 4px 16px rgba(255, 107, 53, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-warm) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .auth-container {
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-medium);
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            animation: slideUp 0.4s ease;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-title {
            font-size: 2.5rem;
            color: var(--primary-orange);
            margin-bottom: 0.5rem;
        }

        .auth-subtitle {
            font-size: 1rem;
            color: var(--text-dark);
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-orange);
            box-shadow: 0 0 8px rgba(255, 107, 53, 0.2);
        }

        .form-button {
            width: 100%;
            padding: 0.85rem;
            background: linear-gradient(135deg, var(--primary-orange), var(--primary-warm));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.3);
        }

        .form-button:active {
            transform: translateY(0);
        }

        .form-toggle {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .form-toggle-link {
            color: var(--primary-orange);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .form-toggle-link:hover {
            text-decoration: underline;
        }

        .form-error {
            color: #D62828;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: none;
        }

        .form-error.show {
            display: block;
        }

        .demo-note {
            background: var(--bg-warm);
            border-left: 4px solid var(--primary-orange);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            color: var(--text-dark);
            line-height: 1.5;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            border-color: var(--primary-orange);
            background: rgba(255, 107, 53, 0.05);
        }

        .radio-option input[type="radio"] {
            margin-right: 0.75rem;
            cursor: pointer;
            accent-color: var(--primary-orange);
        }

        .radio-option label {
            cursor: pointer;
            flex: 1;
            margin: 0;
            font-weight: 500;
        }

        .form-section {
            background: var(--bg-warm);
            padding: 1.2rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
        }

        .form-section-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--primary-orange);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        .form-tab {
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            cursor: pointer;
            color: #666;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .form-tab.active {
            color: var(--primary-orange);
            border-bottom-color: var(--primary-orange);
        }

        .form-step {
            display: none;
            width: 100%;
        }

        .form-step.active {
            display: block;
        }

        @media (max-width: 480px) {
            .auth-container {
                padding: 1.5rem;
            }

            .auth-title {
                font-size: 2rem;
            }

            .form-group {
                margin-bottom: 1.25rem;
            }
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="auth-header">
            <div class="auth-title">üç≤</div>
            <h1 class="auth-subtitle">MUMMY ‚Äì Bhook Lagi Hai</h1>
        </div>

        <div class="demo-note">
            üí° For demo: Use any email and password. This is a demo with backend setup required.
        </div>

        <!-- Login Form -->
        <form id="loginForm" class="auth-form">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input 
                    type="email" 
                    class="form-input" 
                    id="loginEmail" 
                    placeholder="your@email.com"
                    required
                >
                <div class="form-error"></div>
            </div>

            <div class="form-group">
                <label class="form-label">Password</label>
                <input 
                    type="password" 
                    class="form-input" 
                    id="loginPassword" 
                    placeholder="Enter password"
                    required
                >
                <div class="form-error"></div>
            </div>

            <button type="submit" class="form-button">Login</button>
        </form>

        <!-- Registration Form (Hidden by default) -->
        <form id="registerForm" class="auth-form" style="display: none;">
            <!-- Basic Info Step -->
            <div class="form-step active" id="step-basic">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input 
                        type="text" 
                        class="form-input" 
                        id="registerName" 
                        placeholder="Your name"
                        required
                    >
                    <div class="form-error"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input 
                        type="email" 
                        class="form-input" 
                        id="registerEmail" 
                        placeholder="your@email.com"
                        required
                    >
                    <div class="form-error"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input 
                        type="password" 
                        class="form-input" 
                        id="registerPassword" 
                        placeholder="Create password"
                        required
                    >
                    <div class="form-error"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input 
                        type="password" 
                        class="form-input" 
                        id="registerConfirmPassword" 
                        placeholder="Confirm password"
                        required
                    >
                    <div class="form-error"></div>
                </div>

                <button type="button" class="form-button" onclick="nextPreferenceStep()">Next</button>
            </div>

            <!-- Gender Step -->
            <div class="form-step" id="step-gender">
                <div class="form-section">
                    <div class="form-section-title">üë• Gender / Identity?</div>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="gender" value="male">
                            <label>üë® Male</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gender" value="female">
                            <label>üë© Female</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gender" value="other">
                            <label>üßë Other</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gender" value="prefer_not_to_say">
                            <label>ü§ê Prefer not to say</label>
                        </label>
                    </div>
                </div>

                <button type="button" class="form-button" onclick="prevPreferenceStep()" style="background: #999; margin-bottom: 0.5rem;">Back</button>
                <button type="button" class="form-button" onclick="nextGenderStep()">Next</button>
            </div>

            <!-- Food Preferences Step -->
            <div class="form-step" id="step-preferences">
                <div class="form-section">
                    <div class="form-section-title">üßë‚Äçüç≥ Tum kya khana prefer karte ho?</div>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="foodPref" value="veg" required>
                            <label>Vegetarian (Veg)</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="foodPref" value="eggitarian">
                            <label>Eggitarian</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="foodPref" value="nonveg">
                            <label>Non-Veg</label>
                        </label>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">üë®‚Äçüç≥ Tum usually khud khana banate ho ya kabhi-kabhi?</div>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="cookingFreq" value="roz" required>
                            <label>Roz (Daily)</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="cookingFreq" value="kabhikabhi">
                            <label>Kabhi-Kabhi (Sometimes)</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="cookingFreq" value="bahutKam">
                            <label>Bahut Kam (Rarely)</label>
                        </label>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">üå∂Ô∏è Spice Tolerance?</div>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="spiceLevel" value="kam" required>
                            <label>Bilkul Kam (Low)</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="spiceLevel" value="medium">
                            <label>Medium</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="spiceLevel" value="teekha">
                            <label>Bahut Teekha (High)</label>
                        </label>
                    </div>
                </div>

                <button type="button" class="form-button" onclick="prevPreferenceStep()" style="background: #999; margin-bottom: 0.5rem;">Back</button>
                <button type="button" class="form-button" onclick="nextLifestyleStep()">Next</button>
            </div>

            <!-- Lifestyle Step -->
            <div class="form-step" id="step-lifestyle">
                <div class="form-section">
                    <div class="form-section-title">‚è±Ô∏è Cooking Time Preference?</div>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="cookingTime" value="10-15min" required>
                            <label>10‚Äì15 minutes</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="cookingTime" value="20-30min">
                            <label>20‚Äì30 minutes</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="cookingTime" value="aramSe">
                            <label>Time milta hai, aaram se</label>
                        </label>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">üåô Late-night bhook lagti hai?</div>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="lateNightHunger" value="haan" required>
                            <label>Haan (Yes)</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="lateNightHunger" value="kabhikabhi">
                            <label>Kabhi-Kabhi (Sometimes)</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="lateNightHunger" value="nahi">
                            <label>Nahi (No)</label>
                        </label>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">üòÖ Bahar ka khana kitni baar hota hai?</div>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="outsideFood" value="roz" required>
                            <label>Roz (Daily)</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="outsideFood" value="weekends">
                            <label>Weekends</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="outsideFood" value="kabhikabhi">
                            <label>Kabhi-Kabhi (Rarely)</label>
                        </label>
                    </div>
                </div>

                <button type="button" class="form-button" onclick="prevPreferenceStep()" style="background: #999; margin-bottom: 0.5rem;">Back</button>
                <button type="button" class="form-button" onclick="nextRemindersStep()">Next</button>
            </div>

            <!-- Reminders Step -->
            <div class="form-step" id="step-reminders">
                <div class="form-section">
                    <div class="form-section-title">‚ù§Ô∏è MUMMY Reminders chahiye?</div>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="mummyReminders" value="haan" required>
                            <label>Haan, yaad dilate rehna üíï</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="mummyReminders" value="kabhikabhi">
                            <label>Kabhi-Kabhi</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="mummyReminders" value="nahi">
                            <label>Nahi (main responsible hoon üòÑ)</label>
                        </label>
                    </div>
                </div>

                <button type="button" class="form-button" onclick="prevLifestyleStep()" style="background: #999; margin-bottom: 0.5rem;">Back</button>
                <button type="button" class="form-button" onclick="nextLanguageStep()">Next</button>
            </div>

            <!-- Language Preference Step -->
            <div class="form-step" id="step-language">
                <div class="form-section">
                    <div class="form-section-title">üåç Apni Bhasha Chuniye / Choose Your Language</div>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="language" value="english" required>
                            <label>üá¨üáß English</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="language" value="hinglish">
                            <label>üáÆüá≥ Hinglish (Hindi-English Mix)</label>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="language" value="hindi">
                            <label>üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</label>
                        </label>
                    </div>
                </div>

                <button type="button" class="form-button" onclick="prevRemindersStep()" style="background: #999; margin-bottom: 0.5rem;">Back</button>
                <button type="submit" class="form-button" style="background: var(--primary-green);">Complete Registration ‚úÖ</button>
            </div>
        </form>

        <!-- Toggle Links -->
        <div class="form-toggle">
            <span id="toggleText">Don't have an account? </span>
            <span class="form-toggle-link" id="toggleLink">Register here</span>
        </div>
    </div>

    <script>
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const toggleText = document.getElementById('toggleText');
        const toggleLink = document.getElementById('toggleLink');

        toggleLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginForm.style.display = loginForm.style.display === 'none' ? 'block' : 'none';
            registerForm.style.display = registerForm.style.display === 'none' ? 'block' : 'none';
            
            // Reset to first step when toggling to register
            if (registerForm.style.display === 'block') {
                showStep('step-basic');
                toggleText.textContent = 'Already have an account? ';
                toggleLink.textContent = 'Login here';
            } else {
                toggleText.textContent = "Don't have an account? ";
                toggleLink.textContent = 'Register here';
            }
        });

        // Multi-step form navigation
        function showStep(stepId) {
            document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
            document.getElementById(stepId).classList.add('active');
        }

        function nextPreferenceStep() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirm = document.getElementById('registerConfirmPassword').value;

            if (!name || !email || !password || !confirm) {
                alert('Please fill all basic information');
                return;
            }

            if (password !== confirm) {
                alert('Passwords do not match');
                return;
            }

            showStep('step-gender');
        }

        function nextGenderStep() {
            if (!document.querySelector('input[name="gender"]:checked')) {
                alert('Please select your gender/identity');
                return;
            }
            showStep('step-preferences');
        }

        function nextLifestyleStep() {
            if (!document.querySelector('input[name="foodPref"]:checked')) {
                alert('Please select food preference');
                return;
            }
            if (!document.querySelector('input[name="cookingFreq"]:checked')) {
                alert('Please select cooking frequency');
                return;
            }
            if (!document.querySelector('input[name="spiceLevel"]:checked')) {
                alert('Please select spice level');
                return;
            }
            showStep('step-lifestyle');
        }

        function nextRemindersStep() {
            if (!document.querySelector('input[name="cookingTime"]:checked')) {
                alert('Please select cooking time');
                return;
            }
            if (!document.querySelector('input[name="lateNightHunger"]:checked')) {
                alert('Please select late-night hunger preference');
                return;
            }
            if (!document.querySelector('input[name="outsideFood"]:checked')) {
                alert('Please select outside food frequency');
                return;
            }
            showStep('step-reminders');
        }

        function nextLanguageStep() {
            if (!document.querySelector('input[name="mummyReminders"]:checked')) {
                alert('Please select MUMMY reminders preference');
                return;
            }
            showStep('step-language');
        }

        function prevRemindersStep() {
            showStep('step-reminders');
        }

        function prevPreferenceStep() {
            showStep('step-gender');
        }

        function prevLifestyleStep() {
            showStep('step-preferences');
        }

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Demo mode - no backend validation
            if (email && password) {
                localStorage.setItem('mummy_user_logged_in', 'true');
                localStorage.setItem('mummy_user_name', email.split('@')[0]);
                window.location.href = 'index.html';
            }
        });

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            // Validate passwords match
            if (password !== confirmPassword) {
                showError(registerForm, 'registerConfirmPassword', 'Passwords do not match');
                return;
            }

            // Validate all preferences are selected
            if (!document.querySelector('input[name="mummyReminders"]:checked')) {
                alert('Please select MUMMY reminders preference');
                return;
            }

            if (!document.querySelector('input[name="language"]:checked')) {
                alert('Please select your language preference');
                return;
            }

            // Collect preferences
            const preferences = {
                gender: document.querySelector('input[name="gender"]:checked')?.value,
                foodPref: document.querySelector('input[name="foodPref"]:checked')?.value,
                cookingFreq: document.querySelector('input[name="cookingFreq"]:checked')?.value,
                spiceLevel: document.querySelector('input[name="spiceLevel"]:checked')?.value,
                cookingTime: document.querySelector('input[name="cookingTime"]:checked')?.value,
                lateNightHunger: document.querySelector('input[name="lateNightHunger"]:checked')?.value,
                outsideFood: document.querySelector('input[name="outsideFood"]:checked')?.value,
                mummyReminders: document.querySelector('input[name="mummyReminders"]:checked')?.value,
                language: document.querySelector('input[name="language"]:checked')?.value,
            };

            try {
                // Call backend to register user with preferences
                const backendUrl = 'http://localhost/mummy/register_with_preferences.php';
                
                console.log('üì§ Sending registration data to:', backendUrl);
                console.log('Data:', {
                    name: name,
                    email: email,
                    preferences: preferences
                });

                const response = await fetch(backendUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: name,
                        email: email,
                        password: password,
                        preferences: preferences
                    })
                });

                console.log('Response status:', response.status);
                
                const data = await response.json();
                console.log('Response data:', data);

                if (response.ok) {
                    // Save to localStorage for frontend use
                    localStorage.setItem('mummy_user_logged_in', 'true');
                    localStorage.setItem('mummy_user_id', data.user_id);
                    localStorage.setItem('mummy_user_name', data.name);
                    localStorage.setItem('mummy_user_email', data.email);
                    localStorage.setItem('mummy_user_language', preferences.language);
                    localStorage.setItem('mummy_user_preferences', JSON.stringify(preferences));
                    
                    console.log('‚úÖ User registered successfully:', data);
                    alert('‚úÖ Registration successful! Welcome ' + name);
                    window.location.href = 'index.html';
                } else {
                    showError(registerForm, 'registerEmail', data.error || 'Registration failed');
                    console.error('‚ùå Registration error:', data);
                }
            } catch (error) {
                console.error('‚ùå Network/Frontend error:', error);
                showError(registerForm, 'registerEmail', 'Error: ' + error.message + '. Check browser console.');
            }
        });

        function showError(form, fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorEl = field.parentElement.querySelector('.form-error');
            errorEl.textContent = message;
            errorEl.classList.add('show');
            setTimeout(() => {
                errorEl.classList.remove('show');
            }, 3000);
        }

        // Check if already logged in
        if (localStorage.getItem('mummy_user_logged_in')) {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
